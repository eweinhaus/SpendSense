{% extends "base.html" %}

{% block title %}{{ user.name }} - SpendSense MVP{% endblock %}

{% block content %}
<div style="margin-bottom: var(--spacing-6);">
    <a href="/" class="btn btn-secondary">← Back to Dashboard</a>
</div>

<!-- User Information -->
<div class="card" style="margin-bottom: var(--spacing-6);">
    <div class="card-header">User Information</div>
    <div style="display: flex; flex-wrap: wrap; gap: var(--spacing-4); align-items: start; padding: var(--spacing-3);">
        <div style="flex: 1; min-width: 200px;">
            <div style="display: flex; flex-direction: column; gap: var(--spacing-2);">
                <div><strong>Name:</strong> <span style="color: var(--color-neutral-700);">{{ user.name }}</span></div>
                <div><strong>Email:</strong> <span style="color: var(--color-neutral-700);">{{ user.email }}</span></div>
                <div><strong>User ID:</strong> <span style="color: var(--color-neutral-700);">{{ user.id }}</span></div>
            </div>
        </div>
        <div style="flex: 1; min-width: 200px;">
            <div style="display: flex; flex-direction: column; gap: var(--spacing-2);">
                <label style="display: flex; align-items: center; gap: var(--spacing-2); cursor: pointer;">
                    <input type="checkbox" id="consent-checkbox" 
                           {% if user.consent_given %}checked{% endif %}
                           onchange="toggleConsent({{ user.id }})">
                    <span style="font-size: var(--font-size-sm);"><strong>Consent for data processing</strong></span>
                </label>
                <p style="font-size: var(--font-size-sm); color: var(--color-neutral-600); margin: 0;">
                    Created: {{ user.created_at }}
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Detected Signals -->
<div class="card" style="margin-bottom: var(--spacing-6);">
    <div class="card-header">Detected Signals</div>
    <div>
        <!-- Tabs for 30d and 180d windows -->
        <div style="display: flex; gap: var(--spacing-2); margin-bottom: var(--spacing-4); border-bottom: 2px solid var(--color-neutral-200);">
            <button class="nav-link active" id="tab-30d" data-bs-toggle="tab" data-bs-target="#panel-30d" type="button" role="tab" 
                    style="padding: var(--spacing-2) var(--spacing-4); border: none; background: none; border-bottom: 3px solid var(--color-primary); color: var(--color-primary); font-weight: var(--font-weight-medium); cursor: pointer;">
                30-Day Window
            </button>
            <button class="nav-link" id="tab-180d" data-bs-toggle="tab" data-bs-target="#panel-180d" type="button" role="tab"
                    style="padding: var(--spacing-2) var(--spacing-4); border: none; background: none; border-bottom: 3px solid transparent; color: var(--color-neutral-600); font-weight: var(--font-weight-medium); cursor: pointer;">
                180-Day Window
            </button>
        </div>
        
        <div class="tab-content">
            <!-- 30-Day Window -->
            <div class="tab-pane fade show active" id="panel-30d" role="tabpanel">
                {% set window_signals = signals.get('30d', {}) %}
                
                <div style="display: flex; flex-direction: column; gap: var(--spacing-4);">
                    {% if window_signals.get('credit') %}
                    <div>
                        <h5 style="font-size: var(--font-size-xl); font-weight: var(--font-weight-semibold); color: var(--color-neutral-900); margin-bottom: var(--spacing-3);">Credit Utilization</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-2);">
                            <div><strong>Card:</strong> {{ window_signals.credit.card_name }}</div>
                            <div><strong>Utilization:</strong> {{ "%.0f"|format(window_signals.credit.utilization) }}%</div>
                            <div><strong>Balance:</strong> ${{ "%.2f"|format(window_signals.credit.balance) }}</div>
                            <div><strong>Limit:</strong> ${{ "%.2f"|format(window_signals.credit.limit) }}</div>
                            {% if window_signals.credit.interest_charges > 0 %}
                            <div><strong>Interest Charges:</strong> ${{ "%.2f"|format(window_signals.credit.interest_charges) }}/month</div>
                            {% endif %}
                            {% if window_signals.credit.is_overdue %}
                            <div><span class="badge badge-error">Overdue</span></div>
                            {% endif %}
                        </div>
                        <!-- Progress bar for utilization -->
                        <div style="margin-top: var(--spacing-3);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-1);">
                                <span style="font-size: var(--font-size-sm); color: var(--color-neutral-600);">Credit Utilization</span>
                                <span style="font-size: var(--font-size-sm); color: var(--color-neutral-600);">{{ "%.0f"|format(window_signals.credit.utilization) }}%</span>
                            </div>
                            <div style="width: 100%; height: 8px; background-color: var(--color-neutral-200); border-radius: 4px; overflow: hidden;">
                                <div style="height: 100%; width: {{ window_signals.credit.utilization }}%; background-color: {% if window_signals.credit.utilization > 80 %}var(--color-error){% elif window_signals.credit.utilization > 50 %}var(--color-warning){% else %}var(--color-success){% endif %}; transition: width 0.3s ease;"></div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if window_signals.get('subscription') %}
                    <div style="border-top: 1px solid var(--color-neutral-200); padding-top: var(--spacing-4);">
                        <h5 style="font-size: var(--font-size-xl); font-weight: var(--font-weight-semibold); color: var(--color-neutral-900); margin-bottom: var(--spacing-3);">Subscriptions</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-2);">
                            <div><strong>Recurring Merchants:</strong> {{ window_signals.subscription.count }}</div>
                            <div><strong>Monthly Spend:</strong> ${{ "%.2f"|format(window_signals.subscription.monthly_spend) }}</div>
                            <div><strong>Subscription Share:</strong> {{ "%.1f"|format(window_signals.subscription.share) }}%</div>
                            {% if window_signals.subscription.merchants %}
                            <div style="grid-column: 1 / -1;">
                                <strong>Merchants:</strong> {{ window_signals.subscription.merchants|join(", ") }}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if window_signals.get('savings') %}
                    <div style="border-top: 1px solid var(--color-neutral-200); padding-top: var(--spacing-4);">
                        <h5 style="font-size: var(--font-size-xl); font-weight: var(--font-weight-semibold); color: var(--color-neutral-900); margin-bottom: var(--spacing-3);">Savings Signals</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-2);">
                            {% if window_signals.savings.net_inflow is defined %}
                            <div><strong>Net Inflow:</strong> ${{ "%.2f"|format(window_signals.savings.net_inflow) }}</div>
                            {% endif %}
                            {% if window_signals.savings.growth_rate is defined %}
                            <div><strong>Growth Rate:</strong> {{ "%.2f"|format(window_signals.savings.growth_rate) }}%</div>
                            {% endif %}
                            {% if window_signals.savings.emergency_fund_coverage is defined %}
                            <div><strong>Emergency Fund Coverage:</strong> {{ "%.2f"|format(window_signals.savings.emergency_fund_coverage) }} months</div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if window_signals.get('income') %}
                    <div style="border-top: 1px solid var(--color-neutral-200); padding-top: var(--spacing-4);">
                        <h5 style="font-size: var(--font-size-xl); font-weight: var(--font-weight-semibold); color: var(--color-neutral-900); margin-bottom: var(--spacing-3);">Income Signals</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-2);">
                            {% if window_signals.income.frequency is defined %}
                            <div><strong>Payment Frequency:</strong> {{ window_signals.income.frequency }}</div>
                            {% endif %}
                            {% if window_signals.income.variability is defined %}
                            <div><strong>Payment Variability:</strong> {{ "%.4f"|format(window_signals.income.variability) }}</div>
                            {% endif %}
                            {% if window_signals.income.cash_flow_buffer is defined %}
                            <div><strong>Cash-Flow Buffer:</strong> {{ "%.2f"|format(window_signals.income.cash_flow_buffer) }} months</div>
                            {% endif %}
                            {% if window_signals.income.median_pay_gap is defined %}
                            <div><strong>Median Pay Gap:</strong> {{ "%.0f"|format(window_signals.income.median_pay_gap) }} days</div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if not window_signals.get('credit') and not window_signals.get('subscription') and not window_signals.get('savings') and not window_signals.get('income') %}
                    <p style="color: var(--color-neutral-600);">No signals detected for 30-day window.</p>
                    {% endif %}
                </div>
            </div>
            
            <!-- 180-Day Window -->
            <div class="tab-pane fade" id="panel-180d" role="tabpanel">
                {% set window_signals = signals.get('180d', {}) %}
                
                <div style="display: flex; flex-direction: column; gap: var(--spacing-4);">
                    {% if window_signals.get('credit') %}
                    <div>
                        <h5 style="font-size: var(--font-size-xl); font-weight: var(--font-weight-semibold); color: var(--color-neutral-900); margin-bottom: var(--spacing-3);">Credit Utilization</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-2);">
                            <div><strong>Card:</strong> {{ window_signals.credit.card_name }}</div>
                            <div><strong>Utilization:</strong> {{ "%.0f"|format(window_signals.credit.utilization) }}%</div>
                            <div><strong>Balance:</strong> ${{ "%.2f"|format(window_signals.credit.balance) }}</div>
                            <div><strong>Limit:</strong> ${{ "%.2f"|format(window_signals.credit.limit) }}</div>
                            {% if window_signals.credit.interest_charges > 0 %}
                            <div><strong>Interest Charges:</strong> ${{ "%.2f"|format(window_signals.credit.interest_charges) }}/month</div>
                            {% endif %}
                            {% if window_signals.credit.is_overdue %}
                            <div><span class="badge badge-error">Overdue</span></div>
                            {% endif %}
                        </div>
                        <!-- Progress bar for utilization -->
                        <div style="margin-top: var(--spacing-3);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: var(--spacing-1);">
                                <span style="font-size: var(--font-size-sm); color: var(--color-neutral-600);">Credit Utilization</span>
                                <span style="font-size: var(--font-size-sm); color: var(--color-neutral-600);">{{ "%.0f"|format(window_signals.credit.utilization) }}%</span>
                            </div>
                            <div style="width: 100%; height: 8px; background-color: var(--color-neutral-200); border-radius: 4px; overflow: hidden;">
                                <div style="height: 100%; width: {{ window_signals.credit.utilization }}%; background-color: {% if window_signals.credit.utilization > 80 %}var(--color-error){% elif window_signals.credit.utilization > 50 %}var(--color-warning){% else %}var(--color-success){% endif %}; transition: width 0.3s ease;"></div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if window_signals.get('subscription') %}
                    <div style="border-top: 1px solid var(--color-neutral-200); padding-top: var(--spacing-4);">
                        <h5 style="font-size: var(--font-size-xl); font-weight: var(--font-weight-semibold); color: var(--color-neutral-900); margin-bottom: var(--spacing-3);">Subscriptions</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-2);">
                            <div><strong>Recurring Merchants:</strong> {{ window_signals.subscription.count }}</div>
                            <div><strong>Monthly Spend:</strong> ${{ "%.2f"|format(window_signals.subscription.monthly_spend) }}</div>
                            <div><strong>Subscription Share:</strong> {{ "%.1f"|format(window_signals.subscription.share) }}%</div>
                            {% if window_signals.subscription.merchants %}
                            <div style="grid-column: 1 / -1;">
                                <strong>Merchants:</strong> {{ window_signals.subscription.merchants|join(", ") }}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if window_signals.get('savings') %}
                    <div style="border-top: 1px solid var(--color-neutral-200); padding-top: var(--spacing-4);">
                        <h5 style="font-size: var(--font-size-xl); font-weight: var(--font-weight-semibold); color: var(--color-neutral-900); margin-bottom: var(--spacing-3);">Savings Signals</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-2);">
                            {% if window_signals.savings.net_inflow is defined %}
                            <div><strong>Net Inflow:</strong> ${{ "%.2f"|format(window_signals.savings.net_inflow) }}</div>
                            {% endif %}
                            {% if window_signals.savings.growth_rate is defined %}
                            <div><strong>Growth Rate:</strong> {{ "%.2f"|format(window_signals.savings.growth_rate) }}%</div>
                            {% endif %}
                            {% if window_signals.savings.emergency_fund_coverage is defined %}
                            <div><strong>Emergency Fund Coverage:</strong> {{ "%.2f"|format(window_signals.savings.emergency_fund_coverage) }} months</div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if window_signals.get('income') %}
                    <div style="border-top: 1px solid var(--color-neutral-200); padding-top: var(--spacing-4);">
                        <h5 style="font-size: var(--font-size-xl); font-weight: var(--font-weight-semibold); color: var(--color-neutral-900); margin-bottom: var(--spacing-3);">Income Signals</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-2);">
                            {% if window_signals.income.frequency is defined %}
                            <div><strong>Payment Frequency:</strong> {{ window_signals.income.frequency }}</div>
                            {% endif %}
                            {% if window_signals.income.variability is defined %}
                            <div><strong>Payment Variability:</strong> {{ "%.4f"|format(window_signals.income.variability) }}</div>
                            {% endif %}
                            {% if window_signals.income.cash_flow_buffer is defined %}
                            <div><strong>Cash-Flow Buffer:</strong> {{ "%.2f"|format(window_signals.income.cash_flow_buffer) }} months</div>
                            {% endif %}
                            {% if window_signals.income.median_pay_gap is defined %}
                            <div><strong>Median Pay Gap:</strong> {{ "%.0f"|format(window_signals.income.median_pay_gap) }} days</div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if not window_signals.get('credit') and not window_signals.get('subscription') and not window_signals.get('savings') and not window_signals.get('income') %}
                    <p style="color: var(--color-neutral-600);">No signals detected for 180-day window.</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Persona Assignment -->
{% if persona %}
<div class="card" style="margin-bottom: var(--spacing-6);">
    <div class="card-header">Persona Assignment</div>
    <div>
        <div style="margin-bottom: var(--spacing-4);">
            {% if persona.persona_type == 'high_utilization' %}
                <span class="badge badge-persona badge-persona-high-utilization" style="font-size: var(--font-size-lg);">High Utilization</span>
            {% elif persona.persona_type == 'variable_income_budgeter' %}
                <span class="badge badge-persona badge-persona-variable-income" style="font-size: var(--font-size-lg);">Variable Income Budgeter</span>
            {% elif persona.persona_type == 'savings_builder' %}
                <span class="badge badge-persona badge-persona-savings-builder" style="font-size: var(--font-size-lg);">Savings Builder</span>
            {% elif persona.persona_type == 'financial_newcomer' %}
                <span class="badge badge-persona badge-persona-financial-newcomer" style="font-size: var(--font-size-lg);">Financial Newcomer</span>
            {% elif persona.persona_type == 'subscription_heavy' %}
                <span class="badge badge-persona badge-persona-subscription-heavy" style="font-size: var(--font-size-lg);">Subscription-Heavy</span>
            {% else %}
                <span class="badge badge-persona badge-persona-neutral" style="font-size: var(--font-size-lg);">Neutral</span>
            {% endif %}
        </div>
        <div style="margin-bottom: var(--spacing-4);">
            <strong style="color: var(--color-neutral-900);">Assignment Rationale:</strong>
            <p style="margin-top: var(--spacing-2); color: var(--color-neutral-700);">{{ persona.criteria_matched }}</p>
        </div>
        {% if persona.signal_windows %}
        <div style="margin-bottom: var(--spacing-4);">
            <details style="margin-top: var(--spacing-2);">
                <summary style="color: var(--color-primary); font-size: var(--font-size-sm); cursor: pointer; font-weight: var(--font-weight-medium); list-style: none; display: flex; align-items: center; gap: var(--spacing-2); padding: var(--spacing-2); border-radius: 0.375rem; transition: background-color 0.2s;">
                    <span class="details-arrow" style="user-select: none; transition: transform 0.2s; display: inline-block;">▼</span>
                    <strong style="color: var(--color-neutral-900);">Signals Used ({{ persona.signal_windows|length }} window{{ 's' if persona.signal_windows|length > 1 else '' }})</strong>
                </summary>
                <div style="margin-top: var(--spacing-3); padding-left: var(--spacing-6);">
                    {% for window, signal_list in persona.signal_windows.items() %}
                    <div style="margin-bottom: var(--spacing-3);">
                        <strong style="color: var(--color-neutral-700); font-size: var(--font-size-sm);">{{ window }} window:</strong>
                        <div style="display: flex; flex-wrap: wrap; gap: var(--spacing-1); margin-top: var(--spacing-2);">
                            {% for signal in signal_list %}
                            <span class="badge badge-info" style="font-size: var(--font-size-xs); font-weight: var(--font-weight-normal); padding: var(--spacing-1) var(--spacing-2);">{{ signal }}</span>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </details>
        </div>
        {% endif %}
        <p style="font-size: var(--font-size-sm); color: var(--color-neutral-600); margin: 0;">
            Assigned: {{ persona.assigned_at }}
        </p>
    </div>
</div>
{% endif %}

<!-- Recommendations -->
<div class="card" style="margin-bottom: var(--spacing-6);">
    <div class="card-header">Recommendations</div>
    <div>
        {% if not user.consent_given %}
        <div class="alert alert-warning" role="alert">
            <div style="font-size: var(--font-size-lg); font-weight: var(--font-weight-semibold); margin-bottom: var(--spacing-2);">Consent Required</div>
            <p style="margin: 0;">User consent is required to receive personalized recommendations. Please enable consent using the checkbox above to view recommendations.</p>
        </div>
        {% elif recommendations %}
            <div style="display: flex; flex-direction: column; gap: var(--spacing-4);">
                {% for rec in recommendations %}
                <div class="card">
                    <h5 style="font-size: var(--font-size-xl); font-weight: var(--font-weight-semibold); color: var(--color-neutral-900); margin-bottom: var(--spacing-4);">{{ rec.title }}</h5>
                    <div style="color: var(--color-neutral-700); margin-bottom: var(--spacing-4); line-height: var(--line-height-normal);">
                        <p>{{ rec.content|replace('\n', '<br>')|safe }}</p>
                    </div>
                    <div style="border-top: 1px solid var(--color-neutral-200); padding-top: var(--spacing-4); margin-bottom: var(--spacing-4);">
                        <strong style="color: var(--color-neutral-900);">Rationale:</strong>
                        <p style="margin-top: var(--spacing-2); color: var(--color-neutral-700);">{{ rec.rationale|replace('\n', '<br>')|safe }}</p>
                    </div>
                    <button class="btn btn-secondary btn-sm" type="button" 
                            data-bs-toggle="collapse" 
                            data-bs-target="#trace-{{ rec.id }}" 
                            aria-expanded="false">
                        View Decision Trace
                    </button>
                    <div class="collapse mt-3" id="trace-{{ rec.id }}">
                        <div style="padding: var(--spacing-4); background-color: var(--color-neutral-50); border-radius: 0.375rem;">
                            {% if traces.get(rec.id) %}
                                <div style="display: flex; flex-direction: column; gap: var(--spacing-4);">
                                    {% for trace_step in traces[rec.id] %}
                                    <div style="padding-bottom: var(--spacing-4); border-bottom: 1px solid var(--color-neutral-200);">
                                        <div style="display: flex; align-items: center; gap: var(--spacing-2); margin-bottom: var(--spacing-2);">
                                            <span class="badge badge-info">Step {{ trace_step.step }}</span>
                                            <span style="font-weight: var(--font-weight-semibold); color: var(--color-neutral-900);">
                                                {% if trace_step.step == 1 %}
                                                    Signal Detected
                                                {% elif trace_step.step == 2 %}
                                                    Persona Assigned
                                                {% elif trace_step.step == 3 %}
                                                    Recommendation Selected
                                                {% elif trace_step.step == 4 %}
                                                    Rationale Generated
                                                {% endif %}
                                            </span>
                                        </div>
                                        <p style="margin-bottom: var(--spacing-2); color: var(--color-neutral-700);">{{ trace_step.reasoning }}</p>
                                        {% if trace_step.data_cited %}
                                        <details style="margin-top: var(--spacing-2);">
                                            <summary style="color: var(--color-primary); font-size: var(--font-size-sm); cursor: pointer; font-weight: var(--font-weight-medium);">View Data Cited</summary>
                                            <pre style="background-color: white; padding: var(--spacing-3); margin-top: var(--spacing-2); border-radius: 0.375rem; border: 1px solid var(--color-neutral-200); max-height: 200px; overflow-y: auto; font-size: var(--font-size-sm);">{{ trace_step.data_cited|tojsonpretty }}</pre>
                                        </details>
                                        {% endif %}
                                    </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <p style="color: var(--color-neutral-600); margin: 0;">No trace data available.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p style="color: var(--color-neutral-600); margin: 0;">No recommendations available for this user.</p>
        {% endif %}
    </div>
</div>

<!-- Partner Offers -->
{% if user.consent_given and partner_offers %}
<div class="card" style="margin-bottom: var(--spacing-6);">
    <div class="card-header">Partner Offers</div>
    <div>
        <div class="alert alert-info" role="alert" style="margin-bottom: var(--spacing-4);">
            <div style="font-size: var(--font-size-sm);"><strong>Note:</strong> Partner offers are provided for informational purposes. We may receive compensation.</div>
        </div>
        <div style="display: flex; flex-direction: column; gap: var(--spacing-4);">
            {% for offer in partner_offers %}
            <div class="card" style="border-left: 4px solid var(--color-primary);">
                <h5 style="font-size: var(--font-size-xl); font-weight: var(--font-weight-semibold); color: var(--color-neutral-900); margin-bottom: var(--spacing-3);">{{ offer.title }}</h5>
                <p style="color: var(--color-neutral-700); margin-bottom: var(--spacing-3); line-height: var(--line-height-normal);">{{ offer.description }}</p>
                {% if offer.benefits %}
                <ul style="margin-bottom: var(--spacing-3); padding-left: var(--spacing-6);">
                    {% for benefit in offer.benefits %}
                    <li style="margin-bottom: var(--spacing-1); color: var(--color-neutral-700);">• {{ benefit }}</li>
                    {% endfor %}
                </ul>
                {% endif %}
                <div style="border-top: 1px solid var(--color-neutral-200); padding-top: var(--spacing-3);">
                    <p style="font-weight: var(--font-weight-semibold); color: var(--color-neutral-900); margin-bottom: var(--spacing-2);">Why this offer:</p>
                    <p style="color: var(--color-neutral-700); margin: 0;">{{ offer.eligibility_rationale }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>
{% endif %}

<style>
    @media (max-width: 767px) {
        div[style*="grid-template-columns"] {
            grid-template-columns: 1fr !important;
        }
    }
    
    /* Tab styling */
    .nav-link.active {
        border-bottom-color: var(--color-primary) !important;
        color: var(--color-primary) !important;
    }
    
    .nav-link:not(.active) {
        border-bottom-color: transparent !important;
    }
    
    .nav-link:hover:not(.active) {
        color: var(--color-primary) !important;
        opacity: 0.8;
    }
    
    /* Details/summary styling */
    details summary:hover {
        background-color: var(--color-neutral-50);
    }
    
    details[open] summary .details-arrow {
        transform: rotate(180deg);
    }
    
    details summary::-webkit-details-marker {
        display: none;
    }
</style>
{% endblock %}

{% block scripts %}
<script src="/static/js/consent.js?v=2"></script>
{% endblock %}
